<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--><!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--><!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--><!--[if gt IE 8]><!--><html class="no-js">
<!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <title>Flux vs Redux – just4fun</title> <meta name="description" content="Zoro's personal blog."> <meta name="keywords" content="js, flux, redux"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="https://just4fun.github.io/assets/img/logo_coder.jpg"> <meta name="twitter:title" content="Flux vs Redux"> <meta name="twitter:description" content="Redux is very popular in recent two years, it seems like it has become the standard architecture in React application."> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Flux vs Redux"> <meta property="og:description" content="Redux is very popular in recent two years, it seems like it has become the standard architecture in React application."> <meta property="og:url" content="https://just4fun.github.io/2016/07/13/flux-vs-redux/"> <meta property="og:site_name" content="just4fun"> <meta property="og:image" content="https://just4fun.github.io/assets/img/logo_coder.jpg"> <link rel="canonical" href="https://just4fun.github.io/2016/07/13/flux-vs-redux/"> <link href="https://just4fun.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="just4fun Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="https://just4fun.github.io/assets/css/main.css"> <!-- JS --> <script src="https://just4fun.github.io/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="https://just4fun.github.io/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="https://just4fun.github.io/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="https://just4fun.github.io/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="https://just4fun.github.io/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="https://just4fun.github.io/favicon.png"> <link rel="shortcut icon" href="https://just4fun.github.io/favicon.ico"> <!-- Background Image --> <style type="text/css">body {background-image:url(https://just4fun.github.io/assets/img/placeholder-big.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="https://just4fun.github.io/">Home</a></li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="https://just4fun.github.io/posts/">All Posts</a></li> <li><a href="https://just4fun.github.io/tags/">All Tags</a></li> </ul> </li> <li><a href="https://just4fun.github.io/projects/">Projects</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="https://just4fun.github.io/assets/img/logo_coder.jpg" alt="just4fun photo" class="author-photo"> <h4>just4fun</h4> <p>Zoro's personal blog.</p> </li> <li><a href="https://just4fun.github.io/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="mailto:houritsunohikari@gmail.com" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-envelope-square"></i> Email</a> </li> <li> <a href="http://facebook.com/houritsunohikari" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-facebook-square"></i> Facebook</a> </li> <li> <a href="http://instagram.com/houritsunohikari" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-instagram"></i> Instagram</a> </li> <li> <a href="http://github.com/just4fun" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> <li> <a href="http://www.weibo.com/houritsunohikari" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-weibo"></i> Weibo</a> </li> </ul>
<!-- /.dl-submenu --> </li> </ul>
<!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>Flux vs Redux</h1> <h4>13 Jul 2016</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> Reading time ~4 minutes </p>
<!-- /.entry-reading-time --> <a class="btn zoombtn" href="https://just4fun.github.io/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <p><a href="https://github.com/reactjs/redux">Redux</a> is very popular in recent two years, it seems like it has become the standard architecture in React application.</p> <p>Let’s compare it with original <a href="2015/05/12/flux-architecture/">Flux</a>.</p> <p>As Redux <a href="http://redux.js.org/index.html">official doc</a> mentioned,</p> <blockquote> <p>Redux evolves the ideas of Flux, but avoids its complexity.</p> </blockquote> <p>That being said, Redux is also utilizing <strong>unidirectional</strong> data flow.</p> <p><em>But what is the main difference between them?</em> <em>And what is the complexity of Flux?</em></p> <p>As we know, Redux has <strong>three principles</strong>.</p> <ul> <li>Single source of truth</li> <li>State is read-only</li> <li>Changes are made with pure functions</li> </ul> <p>IMO, the main difference between Redux and Flux is mainly focused on the first one.</p> <h2 id="flux-way">Flux Way</h2> <ul> <li>
<strong>Dispatcher</strong> distributes <strong>Actions</strong> to <strong>Stores</strong>
</li> <li>
<strong>Stores</strong> broadcast events to notify <strong>Views</strong> to update</li> </ul> <p>We noticed that <strong>Stores</strong> is plural, which means we can use multiple stores in Flux architecture.</p> <p>Let’s go through an example from Flux source code.</p> <blockquote> <p>Consider there is a flight destination form, which selects a default city when a country is selected.</p> </blockquote> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">flightDispatcher</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Dispatcher</span><span class="p">();</span>

<span class="c1">// keeps track of which country is selected</span>
<span class="kd">let</span> <span class="nx">CountryStore</span> <span class="o">=</span> <span class="p">{</span> <span class="na">country</span><span class="p">:</span> <span class="kc">null</span> <span class="p">};</span>

<span class="c1">// keeps track of which city is selected</span>
<span class="kd">let</span> <span class="nx">CityStore</span> <span class="o">=</span> <span class="p">{</span> <span class="na">city</span><span class="p">:</span> <span class="kc">null</span> <span class="p">};</span>

<span class="c1">// keeps track of the base flight price of the selected city</span>
<span class="kd">let</span> <span class="nx">FlightPriceStore</span> <span class="o">=</span> <span class="p">{</span> <span class="na">price</span><span class="p">:</span> <span class="kc">null</span> <span class="p">};</span>
</code></pre></div></div> <p>When a user changes the selected city, we dispatch the payload.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">flightDispatcher</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">({</span>
  <span class="na">actionType</span><span class="p">:</span> <span class="s1">'city-update'</span><span class="p">,</span>
  <span class="na">selectedCity</span><span class="p">:</span> <span class="s1">'paris'</span>
<span class="p">});</span>
</code></pre></div></div> <p>This payload is digested by <code class="highlighter-rouge">CityStore</code>.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">flightDispatcher</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">payload</span><span class="p">.</span><span class="nx">actionType</span> <span class="o">===</span> <span class="s1">'city-update'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">CityStore</span><span class="p">.</span><span class="nx">city</span> <span class="o">=</span> <span class="nx">payload</span><span class="p">.</span><span class="nx">selectedCity</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div> <p>When the user selects a country, we dispatch the payload.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">flightDispatcher</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">({</span>
  <span class="na">actionType</span><span class="p">:</span> <span class="s1">'country-update'</span><span class="p">,</span>
  <span class="na">selectedCountry</span><span class="p">:</span> <span class="s1">'australia'</span>
<span class="p">});</span>
</code></pre></div></div> <p>This payload is digested by <strong>BOTH</strong> stores.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">CountryStore</span><span class="p">.</span><span class="nx">dispatchToken</span> <span class="o">=</span> <span class="nx">flightDispatcher</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">payload</span><span class="p">.</span><span class="nx">actionType</span> <span class="o">===</span> <span class="s1">'country-update'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">CountryStore</span><span class="p">.</span><span class="nx">country</span> <span class="o">=</span> <span class="nx">payload</span><span class="p">.</span><span class="nx">selectedCountry</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div> <p>When the callback to update <code class="highlighter-rouge">CountryStore</code> is registered, we save a reference to the returned token. Using this token with <code class="highlighter-rouge">waitFor()</code>, we can guarantee that <code class="highlighter-rouge">CountryStore</code> is updated before the callback that updates <code class="highlighter-rouge">CityStore</code> needs to query its data.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">CityStore</span><span class="p">.</span><span class="nx">dispatchToken</span> <span class="o">=</span> <span class="nx">flightDispatcher</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">payload</span><span class="p">.</span><span class="nx">actionType</span> <span class="o">===</span> <span class="s1">'country-update'</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// `CountryStore.country` may not be updated</span>
    <span class="nx">flightDispatcher</span><span class="p">.</span><span class="nx">waitFor</span><span class="p">([</span><span class="nx">CountryStore</span><span class="p">.</span><span class="nx">dispatchToken</span><span class="p">]);</span>
    <span class="c1">// `CountryStore.country` is now guaranteed to be updated</span>

    <span class="c1">// select the default city for the new country</span>
    <span class="nx">CityStore</span><span class="p">.</span><span class="nx">city</span> <span class="o">=</span> <span class="nx">getDefaultCityForCountry</span><span class="p">(</span><span class="nx">CountryStore</span><span class="p">.</span><span class="nx">country</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div> <p>The <code class="highlighter-rouge">country-update</code> payload will be guaranteed to invoke the stores’ registered callbacks in order: <code class="highlighter-rouge">CountryStore</code>, then <code class="highlighter-rouge">CityStore</code>.</p> <hr> <p>You may noticed that we should do lots of stuff in Flux.</p> <ul> <li>should register callbacks both in CountryStore and CityStore to update state</li> <li>should register callbacks both in CountryView and CityView to update views (omitted in code above)</li> <li>should use <code class="highlighter-rouge">waitFor()</code> if we want to guarantee the update order between different stores</li> </ul> <p>IMO, these are the <strong>complexities</strong> in Flux.</p> <h2 id="redux-way">Redux Way</h2> <p>In Redux, there is no Dispatcher (but there is <code class="highlighter-rouge">store.dispatch()</code>), moreover, there in only a <strong>SINGLE</strong> store, which holds the whole application state in a <strong>SINGLE</strong> object.</p> <p>Let’s update the code above in Redux approach.</p> <p>First, we need to create a single store with <code class="highlighter-rouge">reducers</code>, then register a listener on the store. The listener will rerender whole application.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">createStore</span><span class="p">(</span><span class="nx">reducers</span><span class="p">);</span>
<span class="nx">store</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">render</span><span class="p">);</span>
</code></pre></div></div> <p>When a user changes the selected city, we dispatch the payload, but via <code class="highlighter-rouge">store.dispatch()</code> instead.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">({</span>
  <span class="na">actionType</span><span class="p">:</span> <span class="s1">'city-update'</span><span class="p">,</span>
  <span class="na">selectedCity</span><span class="p">:</span> <span class="s1">'paris'</span>
<span class="p">});</span>
</code></pre></div></div> <p>This payload is digested by <code class="highlighter-rouge">CityReducer</code>.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">city</span><span class="p">(</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{},</span> <span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">'city-update'</span><span class="p">:</span>
      <span class="k">return</span> <span class="nx">object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="nx">state</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">city</span><span class="p">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">selectedCity</span>
      <span class="p">});</span>
    <span class="nl">default</span><span class="p">:</span>
      <span class="k">return</span> <span class="nx">state</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>When the user selects a country, we dispatch the payload.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">({</span>
  <span class="na">actionType</span><span class="p">:</span> <span class="s1">'country-update'</span><span class="p">,</span>
  <span class="na">selectedCountry</span><span class="p">:</span> <span class="s1">'australia'</span>
<span class="p">});</span>
</code></pre></div></div> <p>This payload is <strong>ONLY</strong> digested by <code class="highlighter-rouge">CountryReducer</code>.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">country</span><span class="p">(</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{},</span> <span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">'country-update'</span><span class="p">:</span>
      <span class="k">return</span> <span class="nx">object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="nx">state</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">country</span><span class="p">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">selectedCountry</span>
      <span class="p">});</span>
    <span class="nl">default</span><span class="p">:</span>
      <span class="k">return</span> <span class="nx">state</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>But how can we guarantee that select a country will trigger select a default city?</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">componentWillReceiveProps</span><span class="p">(</span><span class="nx">nextProps</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// check whether there is new country selected</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">nextProps</span><span class="p">.</span><span class="nx">country</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">country</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">({</span>
      <span class="na">actionType</span><span class="p">:</span> <span class="s1">'city-update'</span><span class="p">,</span>
      <span class="na">selectedCity</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">getDefaultCityForCountry</span><span class="p">(</span><span class="nx">nextProps</span><span class="p">.</span><span class="nx">country</span><span class="p">)</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Obviously, we render our whole application two times instead of using <code class="highlighter-rouge">waitFor()</code> in Flux to guarantee the order.</p> <hr> <p>Let’s take a look at the steps in Redux approach.</p> <ol> <li>should have CityReducer and CountryReducer to update state</li> <li>only need to register <strong>ONE</strong> callback on the top level store to rerender</li> <li>no need to guarantee order, just <strong>RERENDER</strong>
</li> </ol> <h2 id="tips">Tips</h2> <p>You may noticed that we can also register the callbacks on the top level in Flux for updating Views. In this way, we have no need to guarantee the order, just rerender like how we did in Redux.</p> <p>However, there is one thing different.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">CityStore</span><span class="p">.</span><span class="nx">addChangeListener</span><span class="p">(</span><span class="nx">render</span><span class="p">);</span>
<span class="nx">CountryStore</span><span class="p">.</span><span class="nx">addChangeListener</span><span class="p">(</span><span class="nx">render</span><span class="p">);</span>

<span class="c1">// if there are other stores, we should also</span>
<span class="c1">// register the render callback on them.</span>

<span class="c1">// but in Redux, we only need to register one,</span>
<span class="c1">// since there is only one store holds one object.</span>
</code></pre></div></div> <p>Got <strong>simplicity</strong> of Redux now?</p> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="https://just4fun.github.io/tags/#js" title="Pages tagged js" class="tag"><span class="term">js</span></a><a href="https://just4fun.github.io/tags/#flux" title="Pages tagged flux" class="tag"><span class="term">flux</span></a><a href="https://just4fun.github.io/tags/#redux" title="Pages tagged redux" class="tag"><span class="term">redux</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=https://just4fun.github.io/2016/07/13/flux-vs-redux/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Share</span> </a> <a href="https://twitter.com/intent/tweet?text=https://just4fun.github.io/2016/07/13/flux-vs-redux/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=https://just4fun.github.io/2016/07/13/flux-vs-redux/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> <section id="disqus_thread" class="animated fadeInUp"></section><!-- /#disqus_thread --> </header> <!-- JS --> <script src="https://just4fun.github.io/assets/js/jquery-1.12.0.min.js"></script> <script src="https://just4fun.github.io/assets/js/jquery.dlmenu.min.js"></script> <script src="https://just4fun.github.io/assets/js/jquery.goup.min.js"></script> <script src="https://just4fun.github.io/assets/js/jquery.magnific-popup.min.js"></script> <script src="https://just4fun.github.io/assets/js/jquery.fitvid.min.js"></script> <script src="https://just4fun.github.io/assets/js/scripts.js"></script> <!-- Asynchronous Google Analytics snippet --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-52990380-1', 'auto'); ga('require', 'linkid', 'linkid.js'); ga('send', 'pageview'); </script> <script type="text/javascript"> var disqus_shortname = 'just4fun'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
